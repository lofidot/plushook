<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Simple Sound Player</title>
  <meta name="description" content="A beautiful ambient sound player">
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/feather-icons/4.29.0/feather.min.css">
</head>
<body>
  <!-- Your Webflow section will start here -->
  <div class="main player-container" id="app">
    <div id="background-overlay" class="background-overlay"></div>
    
    <!-- Navigation Bar -->
    <nav class="navbar" id="navbar">
      <!-- Left Dropdown - Plus+ (for non-logged) / Menu (for logged) -->
      <div class="nav-left">
        <div class="dropdown" id="left-dropdown">
          <button class="nav-btn dropdown-toggle" id="left-nav-btn" aria-label="Menu">
            <span id="left-btn-text">Plus+</span>
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M6 9L12 15L18 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
          <div class="dropdown-menu" id="left-dropdown-menu">
            <!-- Content will be dynamically updated based on auth state -->
          </div>
        </div>
      </div>

      <!-- Center Logo -->
      <div class="nav-center">
        <div class="logo-container">
          <img src="https://i.pinimg.com/736x/3a/3d/f9/3a3df9f1c2a4f8b8c5d6e7f8a9b0c1d2.jpg" alt="Logo" class="nav-logo" id="nav-logo">
        </div>
      </div>

      <!-- Right Dropdown - More -->
      <div class="nav-right">
        <div class="dropdown" id="right-dropdown">
          <button class="nav-btn dropdown-toggle" id="right-nav-btn" aria-label="More">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M6 9L12 15L18 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span>More</span>
          </button>
          <div class="dropdown-menu" id="right-dropdown-menu">
            <!-- Content will be updated dynamically -->
          </div>
        </div>
      </div>
    </nav>
    
    <!-- Main content container -->
    <div class="main-content">

      <!-- Timer Container (positioned in center of app) -->
      <div id="timer-container" class="timer-container hidden">
        <!-- Timer Type Switcher (dots) -->
        <div class="timer-type-switcher">
          <div class="timer-type-dot-container">
            <div class="timer-type-dot" data-timer-type="endless"></div>
            <div class="timer-type-tooltip">Endless Timer</div>
          </div>
          <div class="timer-type-dot-container">
            <div class="timer-type-dot" data-timer-type="simple"></div>
            <div class="timer-type-tooltip">Simple Timer</div>
          </div>
          <div class="timer-type-dot-container">
            <div class="timer-type-dot active" data-timer-type="pomodoro"></div>
            <div class="timer-type-tooltip">Pomodoro</div>
          </div>
          <div class="timer-type-dot-container">
            <div class="timer-type-dot" data-timer-type="sleep"></div>
            <div class="timer-type-tooltip">Sleep Timer</div>
          </div>
          <div class="timer-type-dot-container">
            <div class="timer-type-dot" data-timer-type="settings"></div>
            <div class="timer-type-tooltip">Settings</div>
          </div>
        </div>
        
        <!-- Mode Switcher (only visible for Pomodoro) -->
        <div class="mode-switcher" id="modeSwitcher">
          <button class="mode-btn active" data-mode="focus">Focus Time</button>
          <button class="mode-btn" data-mode="short-break">Short Break</button>
          <button class="mode-btn" data-mode="long-break">Long Break</button>
        </div>
        
        <!-- Timer Display -->
        <div class="timer-display" id="timerDisplay">
          <div class="time" id="time">25:00</div>
          <div class="edit-hint">Click to edit</div>
        </div>
        
        <!-- Goal Section -->
        <div class="goal-section" id="goalSection">
          <div class="goal-divider"></div>
          <input 
            type="text" 
            class="goal-input" 
            id="goalInput" 
            placeholder="Goal for This Session?"
          />
        </div>
        
        <!-- Progress Bar -->
        <div class="progress-bar">
          <div class="progress" id="progress"></div>
        </div>
        
        <!-- Controls -->
        <div class="timer-controls">
          <button class="adjust-btn" id="decrease">−</button>
          <div class="control-buttons">
            <button class="start-btn" id="startBtn">Start</button>
            <button class="pause-btn" id="pauseBtn">
              <svg class="icon" viewBox="0 0 24 24">
                <line x1="9" y1="6" x2="9" y2="18"></line>
                <line x1="15" y1="6" x2="15" y2="18"></line>
              </svg>
            </button>
            <button class="restart-btn" id="restartBtn">
              <svg class="icon" viewBox="0 0 24 24">
                <path d="M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8"></path>
                <path d="M21 3v5h-5"></path>
              </svg>
            </button>
          </div>
          <button class="adjust-btn" id="increase">+</button>
        </div>
        
        <!-- Pomodoro Cycles -->
        <div class="cycles-container" id="cyclesContainer">
          <!-- Cycle dots will be generated here -->
        </div>
      </div>

      <!-- Sound selection section -->
      <div id="sound-grid" class="sound-grid"></div>
    </div>
    
    <!-- Control panel -->
    <div class="controls-container">
      <div class="glass-panel controls">
        <button id="hide-ui-btn" class="control-btn hide-btn" aria-label="Toggle UI visibility">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M2 12C2 12 5.63636 5 12 5C18.3636 5 22 12 22 12C22 12 18.3636 19 12 19C5.63636 19 2 12 2 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M12 15C13.6569 15 15 13.6569 15 12C15 10.3431 13.6569 9 12 9C10.3431 9 9 10.3431 9 12C9 13.6569 10.3431 15 12 15Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
        
        <!-- Sound Library Button -->
        <button id="sound-library-btn" class="control-btn" aria-label="Open Sound Library">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M9 18V5l12-2v13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M6 21C7.65685 21 9 19.6569 9 18C9 16.3431 7.65685 15 6 15C4.34315 15 3 16.3431 3 18C3 19.6569 4.34315 21 6 21Z" stroke="currentColor" stroke-width="2"/>
            <path d="M18 19C19.6569 19 21 17.6569 21 16C21 14.3431 19.6569 13 18 13C16.3431 13 15 14.3431 15 16C15 17.6569 16.3431 19 18 19Z" stroke="currentColor" stroke-width="2"/>
          </svg>
        </button>
        
        <button id="play-btn" class="control-btn play-btn" aria-label="Play/Pause">
          <svg width="32" height="32" id="play-icon" class="visible" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M10 8L16 12L10 16V8Z" fill="currentColor" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <svg width="32" height="32" id="pause-icon" class="hidden" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M10 15V9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M14 15V9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>

        <!-- Theme Gallery Button -->
        <button id="theme-btn" class="control-btn theme-btn" aria-label="Change Background Theme">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect x="4" y="4" width="6" height="6" rx="1" stroke="currentColor" stroke-width="2"/>
            <rect x="4" y="14" width="6" height="6" rx="1" stroke="currentColor" stroke-width="2"/>
            <rect x="14" y="4" width="6" height="6" rx="1" stroke="currentColor" stroke-width="2"/>
            <rect x="14" y="14" width="6" height="6" rx="1" stroke="currentColor" stroke-width="2"/>
          </svg>
        </button>

        <!-- Timer Button -->
        <button id="timer-btn" class="control-btn timer-btn" aria-label="Toggle Timer">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
            <polyline points="12,6 12,12 16,14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>

      </div>
    </div>
    
    <!-- Sound Library Bottom Sheet -->
    <div id="sound-library" class="bottom-sheet hidden">
      <div class="sheet-content">
        <div class="sound-header-fixed">
          <div id="mix-mode-switch-container"></div>
          <button id="close-library" class="close-btn" aria-label="Close">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
        </div>
        <!-- Focus Sounds -->
        <div class="sound-category">
          <h4>Focus</h4>
          <div class="sound-library-list">
            <div class="library-sound-wrapper">
              <div class="library-sound-item" data-sound-id="white-noise">
                <div class="library-sound-thumbnail">
                  <img src="https://i.pinimg.com/originals/5f/a7/56/5fa756bd5a44204fc72891f265b4fd2b.gif" alt="White Noise">
                </div>
                <div class="library-sound-status">
                  <svg class="play-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M8 5.14v14.72a.5.5 0 00.76.43l11.52-7.36a.5.5 0 000-.86L8.76 4.71a.5.5 0 00-.76.43z" fill="currentColor"/>
                  </svg>
                  <svg class="pause-icon hidden" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M8 5h2v14H8V5zm6 0h2v14h-2V5z" fill="currentColor"/>
                  </svg>
                </div>
              </div>
              <span class="library-sound-name">White Noise</span>
            </div>
            <div class="library-sound-wrapper">
              <div class="library-sound-item" data-sound-id="brown-noise">
                <div class="library-sound-thumbnail">
                  <img src="https://i.pinimg.com/originals/5f/a7/56/5fa756bd5a44204fc72891f265b4fd2b.gif" alt="Brown Noise">
                </div>
                <div class="library-sound-status">
                  <svg class="play-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M8 5.14v14.72a.5.5 0 00.76.43l11.52-7.36a.5.5 0 000-.86L8.76 4.71a.5.5 0 00-.76.43z" fill="currentColor"/>
                  </svg>
                  <svg class="pause-icon hidden" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M8 5h2v14H8V5zm6 0h2v14h-2V5z" fill="currentColor"/>
                  </svg>
                </div>
              </div>
              <span class="library-sound-name">Brown Noise</span>
            </div>
          </div>
        </div>

        <!-- Nature Sounds -->
        <div class="sound-category">
          <h4>Nature</h4>
          <div class="sound-library-list">
            <div class="library-sound-wrapper">
              <div class="library-sound-item" data-sound-id="heavy-rain">
                <div class="library-sound-thumbnail">
                  <img src="https://i.pinimg.com/originals/5f/a7/56/5fa756bd5a44204fc72891f265b4fd2b.gif" alt="Heavy Rain">
                </div>
                <div class="library-sound-status">
                  <svg class="play-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M8 5.14v14.72a.5.5 0 00.76.43l11.52-7.36a.5.5 0 000-.86L8.76 4.71a.5.5 0 00-.76.43z" fill="currentColor"/>
                  </svg>
                  <svg class="pause-icon hidden" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M8 5h2v14H8V5zm6 0h2v14h-2V5z" fill="currentColor"/>
                  </svg>
                </div>
              </div>
              <span class="library-sound-name">Heavy Rain</span>
            </div>
            <div class="library-sound-wrapper">
              <div class="library-sound-item" data-sound-id="light-rain">
                <div class="library-sound-thumbnail">
                  <img src="https://i.pinimg.com/originals/5f/a7/56/5fa756bd5a44204fc72891f265b4fd2b.gif" alt="Light Rain">
                </div>
                <div class="library-sound-status">
                  <svg class="play-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M8 5.14v14.72a.5.5 0 00.76.43l11.52-7.36a.5.5 0 000-.86L8.76 4.71a.5.5 0 00-.76.43z" fill="currentColor"/>
                  </svg>
                  <svg class="pause-icon hidden" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M8 5h2v14H8V5zm6 0h2v14h-2V5z" fill="currentColor"/>
                  </svg>
                </div>
              </div>
              <span class="library-sound-name">Light Rain</span>
            </div>
          </div>
        </div>

        <!-- Ambient Sounds -->
        <div class="sound-category">
          <h4>Ambient</h4>
          <div class="sound-library-list">
            <div class="library-sound-wrapper">
              <div class="library-sound-item" data-sound-id="coffee-shop">
                <div class="library-sound-thumbnail">
                  <img src="https://i.pinimg.com/originals/e5/18/e8/e518e8a24b9c04a887bd4432289a5e88.gif" alt="Coffee Shop">
                </div>
                <div class="library-sound-status">
                  <svg class="play-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M8 5.14v14.72a.5.5 0 00.76.43l11.52-7.36a.5.5 0 000-.86L8.76 4.71a.5.5 0 00-.76.43z" fill="currentColor"/>
                  </svg>
                  <svg class="pause-icon hidden" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M8 5h2v14H8V5zm6 0h2v14h-2V5z" fill="currentColor"/>
                  </svg>
                </div>
              </div>
              <span class="library-sound-name">Coffee Shop</span>
            </div>
            <div class="library-sound-wrapper">
              <div class="library-sound-item" data-sound-id="fireplace">
                <div class="library-sound-thumbnail">
                  <img src="https://i.pinimg.com/originals/c5/4e/8f/c54e8f5b82a0b0c6ff9d8ccb3f5d66fe.gif" alt="Fireplace">
                </div>
                <div class="library-sound-status">
                  <svg class="play-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M8 5.14v14.72a.5.5 0 00.76.43l11.52-7.36a.5.5 0 000-.86L8.76 4.71a.5.5 0 00-.76.43z" fill="currentColor"/>
                  </svg>
                  <svg class="pause-icon hidden" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M8 5h2v14H8V5zm6 0h2v14h-2V5z" fill="currentColor"/>
                  </svg>
                </div>
              </div>
              <span class="library-sound-name">Fireplace</span>
            </div>
          </div>
        </div>

      </div>
    </div>

    <!-- Theme Modal as Bottom Sheet -->
    <div id="theme-modal" class="bottom-sheet hidden">
      <div class="sheet-content">
        <div class="theme-header-fixed">
          <div class="theme-mode-switcher">
            <button class="theme-mode-btn active" data-mode="themes">Themes</button>
            <button class="theme-mode-btn" data-mode="custom">Custom</button>
          </div>
          <button id="close-modal" class="close-btn" aria-label="Close">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
        </div>
        <div class="modal-content">
          <!-- Custom Theme Section -->
          <div class="theme-section" id="custom-section" style="display: none;">
            <div class="url-input-group">
              <input type="url" id="custom-bg-url" placeholder="Enter image URL">
              <button id="apply-bg-btn" class="primary-btn">Apply</button>
            </div>
            
            <div class="upload-section">
              <h4>Upload your own theme image</h4>
              <div class="file-drop-zone" id="file-drop-zone">
                <div class="drop-zone-content">
                  <svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 15V19A2 2 0 0 1 19 21H5A2 2 0 0 1 3 19V15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <polyline points="7,10 12,15 17,10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <line x1="12" y1="15" x2="12" y2="3" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                  </svg>
                  <p class="drop-text">Drop file here or <span class="browse-link">browse</span></p>
                  <p class="file-types">JPG, PNG, WEBP, HEIC</p>
                </div>
                <input type="file" id="theme-file-input" accept=".jpg,.jpeg,.png,.webp,.heic" style="display: none;">
              </div>
              <button id="apply-upload-btn" class="primary-btn" disabled>Apply</button>
            </div>
          </div>

          <!-- All Themes Grid -->
          <div class="theme-section" id="themes-section">
            <div class="preset-grid">
              <!-- Default Theme Card -->
              <div class="preset-theme-wrapper">
                <div class="preset-theme" data-theme="default" id="default-theme-card">
                  <div class="preset-preview" style="background-image: url('https://i.pinimg.com/originals/5f/a7/56/5fa756bd5a44204fc72891f265b4fd2b.gif')"></div>
                  <div class="theme-description">Uses current sound's background</div>
                </div>
                <span class="theme-name">Default Theme</span>
              </div>

              <!-- Theme Cards -->
              <div class="preset-theme-wrapper">
                <div class="preset-theme" data-theme="https://i.pinimg.com/originals/5f/a7/56/5fa756bd5a44204fc72891f265b4fd2b.gif">
                  <div class="preset-preview" style="background-image: url('https://i.pinimg.com/originals/5f/a7/56/5fa756bd5a44204fc72891f265b4fd2b.gif')"></div>
                </div>
                <span class="theme-name">Rain</span>
              </div>
              <div class="preset-theme-wrapper">
                <div class="preset-theme" data-theme="https://i.pinimg.com/originals/e5/18/e8/e518e8a24b9c04a887bd4432289a5e88.gif">
                  <div class="preset-preview" style="background-image: url('https://i.pinimg.com/originals/e5/18/e8/e518e8a24b9c04a887bd4432289a5e88.gif')"></div>
                </div>
                <span class="theme-name">Forest</span>
              </div>
              <div class="preset-theme-wrapper">
                <div class="preset-theme" data-theme="https://i.pinimg.com/originals/c5/4e/8f/c54e8f5b82a0b0c6ff9d8ccb3f5d66fe.gif">
                  <div class="preset-preview" style="background-image: url('https://i.pinimg.com/originals/c5/4e/8f/c54e8f5b82a0b0c6ff9d8ccb3f5d66fe.gif')"></div>
                </div>
                <span class="theme-name">Ocean</span>
              </div>
              <div class="preset-theme-wrapper">
                <div class="preset-theme" data-theme="https://i.pinimg.com/originals/47/0a/19/470a19a36904fe200610cc1f41eb00d9.gif">
                  <div class="preset-preview" style="background-image: url('https://i.pinimg.com/originals/47/0a/19/470a19a36904fe200610cc1f41eb00d9.gif')"></div>
                </div>
                <span class="theme-name">Sunset</span>
              </div>
              <div class="preset-theme-wrapper">
                <div class="preset-theme" data-theme="https://i.pinimg.com/originals/ff/42/77/ff4277fed6ff46cdcc4514c095c20950.gif">
                  <div class="preset-preview" style="background-image: url('https://i.pinimg.com/originals/ff/42/77/ff4277fed6ff46cdcc4514c095c20950.gif')"></div>
                </div>
                <span class="theme-name">Night City</span>
              </div>
              <div class="preset-theme-wrapper">
                <div class="preset-theme" data-theme="https://i.pinimg.com/originals/bd/47/a9/bd47a96d5a03161929f6c6df6a5f56df.gif">
                  <div class="preset-preview" style="background-image: url('https://i.pinimg.com/originals/bd/47/a9/bd47a96d5a03161929f6c6df6a5f56df.gif')"></div>
                </div>
                <span class="theme-name">Fireplace</span>
              </div>
              <div class="preset-theme-wrapper">
                <div class="preset-theme" data-theme="https://i.pinimg.com/originals/88/33/1f/88331f4dba7cb96cc8e6a0ec29e8339f.gif">
                  <div class="preset-preview" style="background-image: url('https://i.pinimg.com/originals/88/33/1f/88331f4dba7cb96cc8e6a0ec29e8339f.gif')"></div>
                </div>
                <span class="theme-name">Coffee Shop</span>
              </div>
              <div class="preset-theme-wrapper">
                <div class="preset-theme" data-theme="https://i.pinimg.com/originals/c7/a0/07/c7a007e95aae304f3b3e0389a5bb4fb8.gif">
                  <div class="preset-preview" style="background-image: url('https://i.pinimg.com/originals/c7/a0/07/c7a007e95aae304f3b3e0389a5bb4fb8.gif')"></div>
                </div>
                <span class="theme-name">Mountain Lake</span>
              </div>
              <div class="preset-theme-wrapper">
                <div class="preset-theme" data-theme="https://i.pinimg.com/originals/62/71/df/6271df0c58a8f5cc9ec5537e5b73478e.gif">
                  <div class="preset-preview" style="background-image: url('https://i.pinimg.com/originals/62/71/df/6271df0c58a8f5cc9ec5537e5b73478e.gif')"></div>
                </div>
                <span class="theme-name">Cherry Blossoms</span>
              </div>
              <div class="preset-theme-wrapper">
                <div class="preset-theme" data-theme="https://i.pinimg.com/originals/a8/5c/8d/a85c8df5d9db6ce7b5d8f57a50e3d3fe.gif">
                  <div class="preset-preview" style="background-image: url('https://i.pinimg.com/originals/a8/5c/8d/a85c8df5d9db6ce7b5d8f57a50e3d3fe.gif')"></div>
                </div>
                <span class="theme-name">Snowy Night</span>
              </div>
              <div class="preset-theme-wrapper">
                <div class="preset-theme" data-theme="https://i.pinimg.com/originals/d7/7b/3d/d77b3d6a460d0757de9c0bf0403eb153.gif">
                  <div class="preset-preview" style="background-image: url('https://i.pinimg.com/originals/d7/7b/3d/d77b3d6a460d0757de9c0bf0403eb153.gif')"></div>
                </div>
                <span class="theme-name">Library</span>
              </div>
              <div class="preset-theme-wrapper">
                <div class="preset-theme" data-theme="https://i.pinimg.com/originals/2e/7c/3d/2e7c3d32c7f4b1dbb8ac6a98a7a4111d.gif">
                  <div class="preset-preview" style="background-image: url('https://i.pinimg.com/originals/2e/7c/3d/2e7c3d32c7f4b1dbb8ac6a98a7a4111d.gif')"></div>
                </div>
                <span class="theme-name">Space</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Full Screen Settings Modal -->
    <div id="settings-modal" class="full-screen-modal hidden">
      <div class="modal-overlay"></div>
      <div class="modal-container">
        <div class="modal-header">
          <h2>Settings</h2>
          <button id="close-settings-modal" class="close-btn" aria-label="Close Settings">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
        </div>
        <div class="modal-content">
          <!-- Settings content will go here -->
          <p>Your settings options will be added here.</p>
        </div>
      </div>
    </div>

    <!-- Statistics Modal -->
    <div id="stats-modal" class="bottom-sheet hidden">
        <div class="sheet-content">
            <div class="stats-header-fixed">
                <h3>Insights</h3>
                <button id="close-stats" class="close-btn" aria-label="Close">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
            </div>
            <!-- Top Stats Cards -->
            <div class="insights-stats-grid">
                <div class="insights-stat-card">
                    <div class="insights-stat-time" id="insights-focus-time">36h 50m</div>
                    <div class="insights-stat-label">Focus</div>
                </div>
                <div class="insights-stat-card">
                    <div class="insights-stat-time" id="insights-break-time">9h 25m</div>
                    <div class="insights-stat-label">Break</div>
                </div>
                <div class="insights-stat-card">
                    <div class="insights-stat-time" id="insights-session-count">90</div>
                    <div class="insights-stat-label">Session</div>
                </div>
            </div>

            <!-- Period Toggle -->
            <div class="insights-period-toggle">
                <button class="period-btn" data-period="week">Week</button>
                <button class="period-btn active" data-period="month">Month</button>
            </div>

            <!-- Period Navigation -->
            <div class="insights-period-nav">
                <button class="period-nav-btn" id="period-prev">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
                <div class="period-display">
                    <div class="period-main" id="period-main">June</div>
                    <div class="period-sub" id="period-sub"></div>
                </div>
                <button class="period-nav-btn" id="period-next">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
            </div>

            <!-- Chart Type Tabs -->
            <div class="insights-chart-tabs">
                <button class="chart-tab active" data-chart="focus">Focus</button>
                <button class="chart-tab" data-chart="break">Break</button>
                <button class="chart-tab" data-chart="session">Session</button>
            </div>

            <!-- Chart Container -->
            <div class="insights-chart-container">
                <div class="insights-chart" id="insights-chart">
                    <!-- Chart will be generated here -->
                </div>
            </div>

            <!-- Download Button -->
            <button class="insights-download-btn" id="download-report">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 15V19A2 2 0 0 1 19 21H5A2 2 0 0 1 3 19V15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <polyline points="7,10 12,15 17,10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <line x1="12" y1="15" x2="12" y2="3" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
                Download report
            </button>
            <div class="insights-download-note">Report will be saved in CSV</div>
        </div>
    </div>

    <!-- To-Do List Bottom Sheet (styled as a glassy card) -->
    <div id="todo-sheet" class="bottom-sheet hidden">
      <div class="sheet-content">
        <div class="todo-header-fixed">
          <div id="current-date" class="current-date">
            <div class="date-display">
              <span class="day-number">15</span>
              <div class="date-info">
                <span class="month">Jun</span>
                <span class="weekday">Sat</span>
              </div>
            </div>
          </div>
          <button id="close-todo" class="close-btn" aria-label="Close">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
        </div>
        
        <div class="todo-container">
          <!-- New Task Input -->
          <div class="new-task-section">
            <div class="new-task-checkbox">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2" stroke="currentColor" stroke-width="2"/>
              </svg>
            </div>
            <input type="text" id="new-task-input" class="new-task-input" placeholder="Add new task" />
          </div>

          <!-- Focus Section -->
          <div class="task-section focus-section">
            <h3 class="section-title">Focus</h3>
            <ul id="focus-tasks" class="task-list focus-tasks"></ul>
          </div>

          <!-- Next Section -->
          <div class="task-section next-section">
            <h3 class="section-title">Next</h3>
            <ul id="next-tasks" class="task-list next-tasks"></ul>
          </div>

          <!-- Done Section -->
          <div class="task-section done-section">
            <h3 class="section-title">Done</h3>
            <ul id="done-tasks" class="task-list done-tasks"></ul>
          </div>

          <!-- Bottom Navigation -->
          <div class="todo-bottom-nav">
            <div class="task-count">
              <span id="task-count-text">5 tasks</span>
            </div>
            <div class="nav-controls">
              <button class="nav-btn" id="prev-day">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>
              <span class="date-nav-text">Today</span>
              <button class="nav-btn" id="next-day">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- End To-Do List Bottom Sheet -->

    <!-- Timer Settings Modal -->
    <div class="timer-settings-modal" id="timerSettingsModal">
      <div class="settings-content">
        <div class="settings-header">
          <h2 class="settings-title">Timer Settings</h2>
          <button class="close-btn" id="closeTimerSettingsBtn">×</button>
        </div>
        
        <!-- Preset Configurations -->
        <div class="settings-group">
          <label class="settings-label">Timer Presets</label>
          <div class="preset-buttons">
            <button type="button" class="preset-btn" data-preset="classic">25-5-15</button>
            <button type="button" class="preset-btn" data-preset="extended">50-10-30</button>
            <button type="button" class="preset-btn" data-preset="custom">Custom</button>
          </div>
        </div>
        
        <!-- Pomodoro Settings Grid -->
        <div class="settings-grid">
          <div class="settings-group-compact">
            <label class="settings-label-compact" for="focusTimeInput">Focus Timer (min)</label>
            <input type="number" class="settings-input-compact" id="focusTimeInput" min="1" max="120" value="25">
          </div>
          <div class="settings-group-compact">
            <label class="settings-label-compact" for="shortBreakInput">Short Break (min)</label>
            <input type="number" class="settings-input-compact" id="shortBreakInput" min="1" max="30" value="5">
          </div>
          <div class="settings-group-compact">
            <label class="settings-label-compact" for="longBreakInput">Long Break (min)</label>
            <input type="number" class="settings-input-compact" id="longBreakInput" min="1" max="60" value="15">
          </div>
          <div class="settings-group-compact">
            <label class="settings-label-compact" for="cyclesInput">Cycles</label>
            <input type="number" class="settings-input-compact" id="cyclesInput" min="1" max="10" value="4">
          </div>
        </div>
        
        <!-- Divider -->
        <div class="settings-divider"></div>
        
        <!-- Other Timer Settings -->
        <div class="settings-grid" style="grid-template-rows: 1fr;">
          <div class="settings-group-compact">
            <label class="settings-label-compact" for="simpleTimerInput">Simple Timer (min)</label>
            <input type="number" class="settings-input-compact" id="simpleTimerInput" min="1" max="480" value="25">
          </div>
          <div class="settings-group-compact">
            <label class="settings-label-compact" for="sleepTimerInput">Sleep Timer (min)</label>
            <input type="number" class="settings-input-compact" id="sleepTimerInput" min="1" max="480" value="30">
          </div>
        </div>
        
        <!-- Divider -->
        <div class="settings-divider"></div>
        
        <div class="settings-group">
          <label class="settings-label" for="toneSelect">Completion Sound</label>
          <div class="sound-input-container">
            <select class="settings-input sound-select" id="toneSelect">
              <option value="">No Sound</option>
              <!-- Tone options will be populated from Supabase -->
            </select>
            <button type="button" class="play-sound-btn" id="playSoundBtn" title="Play Focus Timer Sound">
              <svg class="icon-small" viewBox="0 0 24 24">
                <polygon points="5,3 19,12 5,21"></polygon>
              </svg>
            </button>
          </div>
        </div>
        
        <div class="settings-group">
          <label class="settings-label ios-switch-container">
            <span class="ios-switch-label">Show Goal Section</span>
            <div class="ios-switch">
              <input type="checkbox" id="showGoalCheckbox" checked>
              <span class="ios-switch-slider"></span>
            </div>
          </label>
        </div>
        
        <div class="settings-actions">
          <button class="settings-btn-secondary" id="cancelTimerSettingsBtn">Cancel</button>
          <button class="settings-btn-primary" id="saveTimerSettingsBtn">Save</button>
        </div>
      </div>
    </div>

    <!-- Remove old show-list-btn if present -->
    <script>document.getElementById('show-list-btn')?.remove();</script>
  </div>
  <!-- === Pricing Modal === -->
  <div id="pricing-modal" class="pricing-modal hidden" style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.8); z-index: 10000; display: flex; align-items: center; justify-content: center;">
    <div class="pricing-panel" style="position: relative; background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); padding: 2em; border-radius: 20px; min-width: 380px; max-width: 420px; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4); text-align: center; border: 1px solid rgba(255, 255, 255, 0.1); z-index: 10001;">
      <div class="pricing-header" style="margin-bottom: 2em;">
        <button id="close-pricing-modal" style="position: absolute; top: 20px; right: 20px; background: rgba(255, 255, 255, 0.1); border: none; color: #fff; cursor: pointer; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: all 0.3s ease;">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
        <h2 style="color: #fff; margin: 0 0 0.5em 0; font-size: 1.8em; font-weight: 600;">Pricing</h2>
        <p style="color: rgba(255, 255, 255, 0.7); margin: 0; font-size: 1.1em;">Get unlimited access to all features</p>
      </div>

      <!-- Pricing Options -->
      <div class="pricing-options" style="margin-bottom: 2em;">
        <div class="pricing-option" data-plan="monthly" data-price="10.99" style="display: flex; align-items: center; justify-content: space-between; padding: 1em; margin-bottom: 0.8em; border: 2px solid rgba(255, 255, 255, 0.1); border-radius: 12px; cursor: pointer; transition: all 0.3s ease; background: rgba(255, 255, 255, 0.05);">
          <div class="pricing-checkbox" style="width: 20px; height: 20px; border: 2px solid rgba(255, 255, 255, 0.3); border-radius: 4px; display: flex; align-items: center; justify-content: center; transition: all 0.3s ease;"></div>
          <div class="pricing-info" style="flex: 1; text-align: left; margin-left: 1em;">
            <div style="color: #fff; font-weight: 500; font-size: 1.1em;">Monthly</div>
            <div style="color: rgba(255, 255, 255, 0.6); font-size: 0.9em;">$10.99 / month</div>
          </div>
        </div>

        <div class="pricing-option selected" data-plan="yearly" data-price="100.99" style="display: flex; align-items: center; justify-content: space-between; padding: 1em; margin-bottom: 0.8em; border: 2px solid #ff4757; border-radius: 12px; cursor: pointer; transition: all 0.3s ease; background: rgba(255, 71, 87, 0.1); position: relative;">
          <div class="pricing-checkbox selected" style="width: 20px; height: 20px; border: 2px solid #ff4757; border-radius: 4px; display: flex; align-items: center; justify-content: center; transition: all 0.3s ease; background: #ff4757;">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M20 6L9 17L4 12" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
          <div class="pricing-info" style="flex: 1; text-align: left; margin-left: 1em;">
            <div style="color: #fff; font-weight: 500; font-size: 1.1em;">Yearly</div>
            <div style="color: rgba(255, 255, 255, 0.6); font-size: 0.9em;">$100.99 / month</div>
          </div>
          <div class="best-value-badge" style="position: absolute; top: -8px; right: 12px; background: #ff4757; color: white; font-size: 0.7em; font-weight: 600; padding: 4px 8px; border-radius: 8px; text-transform: uppercase;">Best Value</div>
        </div>

        <div class="pricing-option" data-plan="lifetime" data-price="299.99" style="display: flex; align-items: center; justify-content: space-between; padding: 1em; margin-bottom: 0.8em; border: 2px solid rgba(255, 255, 255, 0.1); border-radius: 12px; cursor: pointer; transition: all 0.3s ease; background: rgba(255, 255, 255, 0.05);">
          <div class="pricing-checkbox" style="width: 20px; height: 20px; border: 2px solid rgba(255, 255, 255, 0.3); border-radius: 4px; display: flex; align-items: center; justify-content: center; transition: all 0.3s ease;"></div>
          <div class="pricing-info" style="flex: 1; text-align: left; margin-left: 1em;">
            <div style="color: #fff; font-weight: 500; font-size: 1.1em;">Lifetime</div>
            <div style="color: rgba(255, 255, 255, 0.6); font-size: 0.9em;">$299.99 one-time</div>
          </div>
        </div>
      </div>

      <!-- Features -->
      <div class="pricing-features" style="margin-bottom: 2em; text-align: left;">
        <div class="feature-item" style="display: flex; align-items: center; margin-bottom: 1em; color: rgba(255, 255, 255, 0.8);">
          <div style="width: 32px; height: 32px; background: #ff4757; border-radius: 8px; display: flex; align-items: center; justify-content: center; margin-right: 1em; flex-shrink: 0;">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 2L15.09 8.26L22 9L17 14L18.18 21L12 17.77L5.82 21L7 14L2 9L8.91 8.26L12 2Z" fill="white"/>
            </svg>
          </div>
          <div>
            <div style="font-weight: 500; color: #fff; margin-bottom: 2px;">Upgraded Stories</div>
            <div style="font-size: 0.85em; color: rgba(255, 255, 255, 0.6);">Priority order, stealth mode, permanent view history and more.</div>
          </div>
        </div>

        <div class="feature-item" style="display: flex; align-items: center; margin-bottom: 1em; color: rgba(255, 255, 255, 0.8);">
          <div style="width: 32px; height: 32px; background: #ff4757; border-radius: 8px; display: flex; align-items: center; justify-content: center; margin-right: 1em; flex-shrink: 0;">
            <span style="color: white; font-weight: bold; font-size: 0.9em;">x2</span>
          </div>
          <div>
            <div style="font-weight: 500; color: #fff; margin-bottom: 2px;">Doubled Limits</div>
            <div style="font-size: 0.85em; color: rgba(255, 255, 255, 0.6);">Up to 1000 channels, 20 folders, 10 pins, 20 public links, 4 accounts and more.</div>
          </div>
        </div>

        <div class="feature-item" style="display: flex; align-items: center; margin-bottom: 1em; color: rgba(255, 255, 255, 0.8);">
          <div style="width: 32px; height: 32px; background: #ff4757; border-radius: 8px; display: flex; align-items: center; justify-content: center; margin-right: 1em; flex-shrink: 0;">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 1C14.5 1 17 2.5 17 5V9C17 11.5 15.5 13 13 13H11C8.5 13 7 11.5 7 9V5C7 2.5 9.5 1 12 1Z" fill="white"/>
              <path d="M19 10V12C19 16.97 15.84 21.16 11 21.92V20H13C13.55 20 14 19.55 14 19C14 18.45 13.55 18 13 18H11V15.92C15.84 15.16 19 10.97 19 6V8C21.21 8 23 9.79 23 12C23 14.21 21.21 16 19 16H5C2.79 16 1 14.21 1 12C1 9.79 2.79 8 5 8V6C5 10.97 8.16 15.16 13 15.92V18H11C10.45 18 10 18.45 10 19C10 19.55 10.45 20 11 20H13V21.92C8.16 21.16 5 16.97 5 12V10H19Z" fill="white"/>
            </svg>
          </div>
          <div>
            <div style="font-weight: 500; color: #fff; margin-bottom: 2px;">Voice-to-Text Conversion</div>
            <div style="font-size: 0.85em; color: rgba(255, 255, 255, 0.6);">Ability to read the transcript of any incoming voice message.</div>
          </div>
        </div>
      </div>

      <!-- Action Button -->
      <button id="pricing-action-btn" style="width: 100%; padding: 1em; border-radius: 12px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; font-weight: 600; font-size: 1.1em; cursor: pointer; transition: all 0.3s ease; margin-bottom: 1em;">
        Gift Subscription for $100.99
      </button>
    </div>
  </div>

  <!-- === Auth Modal === -->
  <div id="auth-modal" class="auth-modal hidden" style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.5); z-index: 9999; display: none; align-items: center; justify-content: center;">
    <div class="glass-panel" style="position: relative; background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); padding: 2em; border-radius: 12px; min-width: 320px; max-width: 90%; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1); text-align: left; border: 1px solid rgba(255, 255, 255, 0.2); z-index: 10000;">
      <div class="modal-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5em;">
        <h2 style="color: #fff; margin: 0; font-size: 1.5em;">Welcome</h2>
        <button id="close-auth-modal" style="background: none; border: none; color: #fff; cursor: pointer; font-size: 1.5em; padding: 0.5em;">×</button>
      </div>

      <!-- Signup Form -->
      <form id="auth-form" class="auth-form" style="position: relative; z-index: 10001;">
        <div class="form-group" style="margin-bottom: 1em;">
          <label for="auth-email" style="color: #fff; display: block; margin-bottom: 0.5em; font-size: 0.9em;">Email</label>
          <input type="email" id="auth-email" required style="width: 100%; padding: 0.75em; border-radius: 8px; border: 1px solid rgba(255, 255, 255, 0.2); background: rgba(255, 255, 255, 0.1); color: #fff; margin-bottom: 1em; font-size: 1em;">
        </div>
        <div class="form-group" style="margin-bottom: 1.5em;">
          <label for="auth-password" style="color: #fff; display: block; margin-bottom: 0.5em; font-size: 0.9em;">Password</label>
          <input type="password" id="auth-password" required style="width: 100%; padding: 0.75em; border-radius: 8px; border: 1px solid rgba(255, 255, 255, 0.2); background: rgba(255, 255, 255, 0.1); color: #fff; font-size: 1em;">
        </div>
        <button type="button" class="auth-btn" id="signup-btn" style="width: 100%; padding: 0.75em; border-radius: 8px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: #fff; border: none; cursor: pointer; transition: all 0.3s ease; font-size: 1em; font-weight: 600;">Pay $100.99 & Sign up</button>
        <div class="error-message" id="auth-error-message" style="color: #ff4444; margin-top: 0.5em; text-align: center; font-size: 0.9em;"></div>
      </form>
    </div>
  </div>


  <script src="https://cdnjs.cloudflare.com/ajax/libs/feather-icons/4.29.0/feather.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    console.log('Script tag loaded!');
    alert('JavaScript is running!');
    
    // Wait for Supabase library to load, then initialize auth
    document.addEventListener('DOMContentLoaded', () => {
      console.log('DOMContentLoaded fired!');
      
      // Check if Supabase is available
      if (typeof window.supabase === 'undefined') {
        console.error('Supabase library not loaded');
        return;
      }
      
      console.log('Supabase is available, continuing...');

      // Initialize Supabase (this should be moved to main.js eventually)
      const SUPABASE_URL = 'https://ojeyqqzpmhapnwwupely.supabase.co';
      const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9qZXlxcXpwbWhhcG53d3VwZWx5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc1NDkwMDYsImV4cCI6MjA2MzEyNTAwNn0.8KrxB1P76kTtdaPxH8fINqCa6oB6xzA_BesvXpxsCF4';
      const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

      // --- Auth Modal Logic ---
      const authModal = document.getElementById('auth-modal');
      const authForm = document.getElementById('auth-form');
      const signupBtn = document.getElementById('signup-btn');
      const errorMessage = document.getElementById('auth-error-message');
      const closeAuthModal = document.getElementById('close-auth-modal');

      // Function to show modal
      function showAuthModal() {
        console.log('Showing auth modal');
        if (authModal) {
          authModal.classList.remove('hidden');
          authModal.style.display = 'flex';
          // Ensure the modal content is visible
          const modalContent = authModal.querySelector('.glass-panel');
          if (modalContent) {
            modalContent.style.display = 'block';
          }
        }
      }

      // Function to hide modal
      function hideAuthModal() {
        console.log('Hiding auth modal');
        if (authModal) {
          authModal.classList.add('hidden');
          authModal.style.display = 'none';
        }
      }

      // Close modal when clicking the close button
      if (closeAuthModal) {
        closeAuthModal.addEventListener('click', hideAuthModal);
      }

      // Close modal when clicking outside
      if (authModal) {
        authModal.addEventListener('click', (e) => {
          if (e.target === authModal) {
            hideAuthModal();
          }
        });
      }

      async function checkAuth() {
        console.log('Checking auth...');
        try {
          const { data: { session } } = await supabase.auth.getSession();
          console.log('Session:', session);
          
          if (session) {
            console.log('Session exists, hiding modal');
            hideAuthModal();
          } else {
            console.log('No session, but not showing modal automatically');
            // Don't show modal automatically - only show when user requests it
            hideAuthModal();
          }
        } catch (error) {
          console.error('Auth check error:', error);
          // Don't show modal automatically on error
          hideAuthModal();
        }
      }

      // Handle login
      if (authForm) {
        authForm.addEventListener('submit', async (e) => {
          e.preventDefault();
          errorMessage.textContent = '';
          const email = document.getElementById('auth-email').value;
          const password = document.getElementById('auth-password').value;
          
          try {
            const { error } = await supabase.auth.signInWithPassword({ email, password });
            if (error) throw error;
            hideAuthModal();
          } catch (error) {
            errorMessage.textContent = error.message;
          }
        });
      }

      // Handle signup and payment
      if (signupBtn) {
        signupBtn.addEventListener('click', async () => {
          errorMessage.textContent = '';
          const email = document.getElementById('auth-email').value;
          const password = document.getElementById('auth-password').value;

          if (!email || !password) {
            errorMessage.textContent = "Please enter both email and password";
            return;
          }

          try {
            // Show loading state
            const originalText = signupBtn.textContent;
            signupBtn.textContent = "Creating Account...";
            signupBtn.disabled = true;

            // Create account
            const { data: { user }, error: signUpError } = await supabase.auth.signUp({ 
              email, 
              password,
              options: {
                emailRedirectTo: window.location.origin
              }
            });

            if (signUpError) throw signUpError;

            // Show processing state
            signupBtn.textContent = "Processing Payment...";
            
            // Start checkout process with Creem using selected plan
            try {
              console.log('Initiating checkout process with plan:', selectedPlan);
              
              // Use the functions/checkout.js endpoint
              const response = await fetch('/functions/checkout', {
                method: 'POST',
                headers: { 
                  'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                  email,
                  userId: user.id,
                  product_id: selectedPlan.productId,
                  success_url: `${window.location.origin}/success`,
                  metadata: {
                    signupDate: new Date().toISOString(),
                    source: 'web_signup',
                    plan: selectedPlan.plan,
                    price: selectedPlan.price
                  }
                })
              });

              console.log('Checkout response status:', response.status);
              
              if (!response.ok) {
                const errorText = await response.text();
                console.error('Error response:', errorText);
                throw new Error(`HTTP error! status: ${response.status}`);
              }
              
              const responseText = await response.text();
              console.log('Checkout response text:', responseText);

              if (!responseText) {
                throw new Error('Empty response from checkout service');
              }

              let data;
              try {
                data = JSON.parse(responseText);
              } catch (parseError) {
                console.error('Failed to parse response as JSON:', parseError);
                throw new Error('Invalid response from checkout service');
              }

              if (data.url) {
                console.log('Redirecting to checkout URL:', data.url);
                window.location.href = data.url;
              } else if (data.error) {
                console.error('Checkout error:', data.error);
                throw new Error(data.error);
              } else {
                console.error('Invalid response format:', data);
                throw new Error('Invalid response format from checkout service');
              }
            } catch (checkoutError) {
              console.error('Checkout process error:', checkoutError);
              errorMessage.textContent = checkoutError.message || 'Failed to initiate checkout. Please try again.';
              signupBtn.textContent = originalText;
              signupBtn.disabled = false;
              return;
            }
          } catch (error) {
            console.error('Signup/Payment error:', error);
            errorMessage.textContent = error.message;
            // Reset button state
            signupBtn.textContent = `Pay $${selectedPlan.price} & Sign up`;
            signupBtn.disabled = false;
          }
        });
      }

      // Check auth after everything is set up
      console.log('DOM loaded, checking auth');
      checkAuth();

      // Listen for auth state changes
      supabase.auth.onAuthStateChange((_event, session) => {
        if (session) {
          hideAuthModal();
        } else {
          // Don't automatically show auth modal when session ends
          hideAuthModal();
        }
      });

      // Make supabase available globally for main.js
      window.supabaseClient = supabase;

      // --- Pricing Modal Logic (moved before navigation) ---
      const pricingModal = document.getElementById('pricing-modal');
      const closePricingModal = document.getElementById('close-pricing-modal');
      const pricingActionBtn = document.getElementById('pricing-action-btn');
      const authModal = document.getElementById('auth-modal');
      const signupBtn = document.getElementById('signup-btn');
      
      let selectedPlan = {
        plan: 'yearly',
        price: '100.99',
        productId: 'prod_yearly_default' // You'll need to provide the actual product IDs
      };

      // Pricing plan data - you'll need to provide the actual Creem product IDs
      const pricingPlans = {
        monthly: {
          price: '10.99',
          productId: 'prod_monthly_id', // Replace with actual Creem product ID
          displayText: 'monthly'
        },
        yearly: {
          price: '100.99',
          productId: 'prod_yearly_id', // Replace with actual Creem product ID
          displayText: 'yearly'
        },
        lifetime: {
          price: '299.99',
          productId: 'prod_lifetime_id', // Replace with actual Creem product ID
          displayText: 'one-time'
        }
      };

      // Show pricing modal function
      function showPricingModal() {
        console.log('showPricingModal called', pricingModal);
        if (pricingModal) {
          pricingModal.classList.remove('hidden');
          pricingModal.style.display = 'flex';
          console.log('Pricing modal should now be visible');
        } else {
          console.error('Pricing modal element not found');
        }
      }

      // Make showPricingModal globally available
      window.showPricingModal = showPricingModal;

      // Show auth modal function (placeholder for now)
      function showAuthModal() {
        console.log('showAuthModal called - redirecting to pricing');
        // For now, redirect to pricing since auth is integrated with pricing
        showPricingModal();
      }

      // Make showAuthModal globally available
      window.showAuthModal = showAuthModal;

      // Hide pricing modal function
      function hidePricingModal() {
        if (pricingModal) {
          pricingModal.classList.add('hidden');
          pricingModal.style.display = 'none';
        }
      }

      // Close pricing modal
      if (closePricingModal) {
        closePricingModal.addEventListener('click', hidePricingModal);
      }

      // Close on backdrop click
      if (pricingModal) {
        pricingModal.addEventListener('click', (e) => {
          if (e.target === pricingModal) {
            hidePricingModal();
          }
        });
      }

      // Handle pricing option selection
      document.querySelectorAll('.pricing-option').forEach(option => {
        option.addEventListener('click', function() {
          // Remove selected class from all options
          document.querySelectorAll('.pricing-option').forEach(opt => {
            opt.classList.remove('selected');
            opt.style.border = '2px solid rgba(255, 255, 255, 0.1)';
            opt.style.background = 'rgba(255, 255, 255, 0.05)';
            const checkbox = opt.querySelector('.pricing-checkbox');
            checkbox.classList.remove('selected');
            checkbox.style.border = '2px solid rgba(255, 255, 255, 0.3)';
            checkbox.style.background = 'transparent';
            checkbox.innerHTML = '';
          });

          // Add selected class to clicked option
          this.classList.add('selected');
          this.style.border = '2px solid #ff4757';
          this.style.background = 'rgba(255, 71, 87, 0.1)';
          
          const checkbox = this.querySelector('.pricing-checkbox');
          checkbox.classList.add('selected');
          checkbox.style.border = '2px solid #ff4757';
          checkbox.style.background = '#ff4757';
          checkbox.innerHTML = `
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M20 6L9 17L4 12" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          `;

          // Update selected plan
          const plan = this.getAttribute('data-plan');
          const price = this.getAttribute('data-price');
          selectedPlan = {
            plan: plan,
            price: price,
            productId: pricingPlans[plan].productId
          };

          // Update action button text
          if (pricingActionBtn) {
            if (plan === 'lifetime') {
              pricingActionBtn.textContent = `Pay $${price} (One-time)`;
            } else {
              pricingActionBtn.textContent = `Gift Subscription for $${price}`;
            }
          }

          // Update auth modal button text
          if (signupBtn) {
            signupBtn.textContent = `Pay $${price} & Sign up`;
          }
        });
      });

      // Handle pricing action button click
      if (pricingActionBtn) {
        pricingActionBtn.addEventListener('click', function() {
          hidePricingModal();
          showAuthModal();
        });
      }

      // Expose function globally so it can be called from navigation
      window.showPricingModal = showPricingModal;
      
      // Also expose hideAuthModal globally
      window.showAuthModal = showAuthModal;
      window.hideAuthModal = hideAuthModal;

      // --- Navigation Functionality ---
      console.log('About to initialize navigation...');
      
      // Simple test first
      const testBtn = document.getElementById('left-nav-btn');
      console.log('Test button found:', !!testBtn);
      if (testBtn) {
        testBtn.addEventListener('click', function() {
          console.log('SIMPLE TEST: Button clicked!');
          alert('Button works!');
        });
      }
      
      // Add a small delay to ensure all elements are rendered
      setTimeout(() => {
        initializeNavigation();
      }, 100);

      function initializeNavigation() {
        console.log('initializeNavigation called');
        const leftDropdown = document.getElementById('left-dropdown');
        const rightDropdown = document.getElementById('right-dropdown');
        const leftBtn = document.getElementById('left-nav-btn');
        const rightBtn = document.getElementById('right-nav-btn');
        const leftMenu = document.getElementById('left-dropdown-menu');
        const rightMenu = document.getElementById('right-dropdown-menu');

        console.log('Navigation elements found:', {
          leftDropdown: !!leftDropdown,
          rightDropdown: !!rightDropdown,
          leftBtn: !!leftBtn,
          rightBtn: !!rightBtn,
          leftMenu: !!leftMenu,
          rightMenu: !!rightMenu
        });

        // Add class to dropdown menus for positioning
        if (leftMenu) leftMenu.classList.add('left');
        if (rightMenu) rightMenu.classList.add('right');

        // Dropdown toggle functionality
        leftBtn?.addEventListener('click', (e) => {
          console.log('Left button clicked!');
          e.stopPropagation();
          const isCurrentlyActive = leftDropdown.classList.contains('active');
          console.log('Current active state:', isCurrentlyActive);
          closeAllDropdowns();
          if (!isCurrentlyActive) {
            leftDropdown.classList.add('active');
            console.log('Added active class to left dropdown');
          }
        });

        rightBtn?.addEventListener('click', (e) => {
          e.stopPropagation();
          const isCurrentlyActive = rightDropdown.classList.contains('active');
          closeAllDropdowns();
          if (!isCurrentlyActive) {
            rightDropdown.classList.add('active');
          }
        });

        // Close dropdowns when clicking outside
        document.addEventListener('click', (e) => {
          if (!e.target.closest('.dropdown')) {
            closeAllDropdowns();
          }
        });

        function closeAllDropdowns() {
          document.querySelectorAll('.dropdown').forEach(dropdown => {
            dropdown.classList.remove('active');
          });
        }

        // Event delegation for dynamic menu items
        document.addEventListener('click', (e) => {
          if (e.target.closest('#signup-menu-item')) {
            e.preventDefault();
            console.log('Signup menu item clicked via delegation');
            window.showPricingModal();
          }
          if (e.target.closest('#pricing-link')) {
            e.preventDefault();
            console.log('Pricing menu item clicked via delegation');
            window.showPricingModal();
          }
          if (e.target.closest('#login-menu-item')) {
            e.preventDefault();
            console.log('Login menu item clicked via delegation');
            window.showAuthModal();
          }
        });

        // Update navigation based on auth state
        updateNavigationForAuthState();
        // Initialize More menu
        updateMoreMenu();
      }

      function updateNavigationForAuthState() {
        const leftBtnText = document.getElementById('left-btn-text');
        const leftBtn = document.getElementById('left-nav-btn');
        const leftMenu = document.getElementById('left-dropdown-menu');
        
        // Check if user is logged in
        supabase.auth.getSession().then(({ data: { session } }) => {
          if (session) {
            // User is logged in - show Menu
            leftBtnText.textContent = 'Menu';
            leftBtn.classList.remove('plus-btn');
            updateLoggedInMenu(leftMenu);
          } else {
            // User is not logged in - show Plus+
            leftBtnText.textContent = 'Plus+';
            leftBtn.classList.add('plus-btn');
            updatePlusMenu(leftMenu);
          }
        });
      }

      function updatePlusMenu(menu) {
        menu.innerHTML = `
          <a href="#" class="dropdown-item" id="signup-menu-item">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M16 21V19A4 4 0 0 0 12 15H5A4 4 0 0 0 1 19V21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <circle cx="8.5" cy="7" r="4" stroke="currentColor" stroke-width="2"/>
              <line x1="20" y1="8" x2="20" y2="14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              <line x1="23" y1="11" x2="17" y2="11" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
            Sign Up
          </a>
          <a href="#" class="dropdown-item" id="login-menu-item">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M15 3H19A2 2 0 0 1 21 5V19A2 2 0 0 1 19 21H15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <polyline points="10,17 15,12 10,7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <line x1="15" y1="12" x2="3" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
            Sign In
          </a>
          <div class="dropdown-divider"></div>
          <a href="#" class="dropdown-item" id="features-link">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <polyline points="22,12 18,12 15,21 9,3 6,12 2,12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Features
          </a>
          <a href="#" class="dropdown-item" id="pricing-link">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <line x1="12" y1="1" x2="12" y2="23" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              <path d="M17 5H9.5A3.5 3.5 0 0 0 6 8.5V8.5A3.5 3.5 0 0 0 9.5 12H14.5A3.5 3.5 0 0 1 18 15.5V15.5A3.5 3.5 0 0 1 14.5 19H6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
            Pricing
          </a>
          <div class="dropdown-divider"></div>
          <a href="#" class="dropdown-item" id="about-link">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
              <path d="M9.09 9A3 3 0 0 1 12 6C13.66 6 15 7.34 15 9C15 10.66 13.66 12 12 12H12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              <line x1="12" y1="17" x2="12.01" y2="17" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
            About
          </a>
          <a href="#" class="dropdown-item" id="help-link">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
              <path d="M9.09 9A3 3 0 0 1 12 6C13.66 6 15 7.34 15 9C15 10.66 13.66 12 12 12H12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              <line x1="12" y1="17" x2="12.01" y2="17" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
            Help & Support
          </a>
          <a href="#" class="dropdown-item" id="feedback-link">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M21 15A2 2 0 0 1 19 17H7L4 20V5A2 2 0 0 1 6 3H19A2 2 0 0 1 21 5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Feedback
          </a>
          <a href="#" class="dropdown-item" id="privacy-link">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <rect x="3" y="11" width="18" height="10" rx="2" ry="2" stroke="currentColor" stroke-width="2"/>
              <circle cx="12" cy="16" r="1" stroke="currentColor" stroke-width="2"/>
              <path d="M7 11V7A5 5 0 0 1 17 7V11" stroke="currentColor" stroke-width="2"/>
            </svg>
            Privacy Policy
          </a>
          <a href="#" class="dropdown-item" id="terms-link">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M14 2H6A2 2 0 0 0 4 4V20A2 2 0 0 0 6 22H18A2 2 0 0 0 20 20V8Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <polyline points="14,2 14,8 20,8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <line x1="16" y1="13" x2="8" y2="13" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              <line x1="16" y1="17" x2="8" y2="17" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              <polyline points="10,9 9,9 8,9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Terms of Service
          </a>
        `;

      }

      function updateLoggedInMenu(menu) {
        menu.innerHTML = `
          <a href="#" class="dropdown-item" id="profile-link">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M20 21V19A4 4 0 0 0 16 15H8A4 4 0 0 0 4 19V21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2"/>
            </svg>
            Profile
          </a>
          <a href="#" class="dropdown-item" id="dashboard-link">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <rect x="3" y="3" width="18" height="18" rx="2" ry="2" stroke="currentColor" stroke-width="2"/>
              <rect x="9" y="9" width="13" height="13" rx="2" ry="2" stroke="currentColor" stroke-width="2"/>
            </svg>
            Dashboard
          </a>
          <a href="#" class="dropdown-item" id="settings-menu-link">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2"/>
              <path d="M19.4 15A1.65 1.65 0 0 0 21 13.34L20.73 10.66A1.65 1.65 0 0 0 19.4 9L16.74 8.35A7.81 7.81 0 0 0 15.45 6.9L16.1 4.24A1.65 1.65 0 0 0 14.66 2.27L11.98 2.54A1.65 1.65 0 0 0 10.34 3.9L9.69 6.56A7.81 7.81 0 0 0 8.24 7.85L5.58 7.2A1.65 1.65 0 0 0 3.61 8.64L3.88 11.32A1.65 1.65 0 0 0 5.24 12.96L7.9 13.61A7.81 7.81 0 0 0 9.19 15.06L8.54 17.72A1.65 1.65 0 0 0 9.98 19.69L12.66 19.42A1.65 1.65 0 0 0 14.3 18.06L14.95 15.4A7.81 7.81 0 0 0 16.4 14.11L19.06 14.76A1.65 1.65 0 0 0 21.03 13.32L20.76 10.64A1.65 1.65 0 0 0 19.4 9.01Z" stroke="currentColor" stroke-width="2"/>
            </svg>
            Settings
          </a>
          <div class="dropdown-divider"></div>
          <a href="#" class="dropdown-item" id="logout-link">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M9 21H5A2 2 0 0 1 3 19V5A2 2 0 0 1 5 3H9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <polyline points="16,17 21,12 16,7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <line x1="21" y1="12" x2="9" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
            Sign Out
          </a>
        `;

        // Add event listener for logout
        document.getElementById('logout-link')?.addEventListener('click', async (e) => {
          e.preventDefault();
          try {
            await supabase.auth.signOut();
            updateNavigationForAuthState();
          } catch (error) {
            console.error('Error signing out:', error);
          }
        });
      }

      function updateMoreMenu() {
        const rightMenu = document.getElementById('right-dropdown-menu');
        rightMenu.innerHTML = `
          <a href="#" class="dropdown-item" id="stats-menu-item">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M18 20V10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M12 20V4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M6 20V14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            View Statistics
          </a>
          <a href="#" class="dropdown-item" id="todo-menu-item">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <rect x="3" y="5" width="18" height="14" rx="2" stroke="currentColor" stroke-width="2"/>
              <line x1="8" y1="9" x2="16" y2="9" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              <line x1="8" y1="13" x2="16" y2="13" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              <line x1="8" y1="17" x2="16" y2="17" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
            Open To-Do List
          </a>
        `;

        // Add event listeners for More menu items  
        document.getElementById('stats-menu-item')?.addEventListener('click', (e) => {
          e.preventDefault();
          console.log('Stats menu item clicked');
          
          // Close any open bottom sheets
          document.querySelectorAll('.bottom-sheet.active').forEach(sheet => {
            sheet.classList.remove('active');
            setTimeout(() => sheet.classList.add('hidden'), 300);
          });
          
          // Trigger stats modal
          const statsModal = document.getElementById('stats-modal');
          if (statsModal) {
            statsModal.classList.remove('hidden');
            requestAnimationFrame(() => {
              statsModal.classList.add('active');
            });
            console.log('Stats modal opened');
          } else {
            console.error('Stats modal not found');
          }
          
          // Close dropdown
          closeAllDropdowns();
        });

        document.getElementById('todo-menu-item')?.addEventListener('click', (e) => {
          e.preventDefault();
          console.log('Todo menu item clicked');
          
          // Close any open bottom sheets
          document.querySelectorAll('.bottom-sheet.active').forEach(sheet => {
            sheet.classList.remove('active');
            setTimeout(() => sheet.classList.add('hidden'), 300);
          });
          
          // Trigger todo sheet
          const todoSheet = document.getElementById('todo-sheet');
          if (todoSheet) {
            todoSheet.classList.remove('hidden');
            
            // Date will be updated by the todo app initialization
            
            requestAnimationFrame(() => {
              todoSheet.classList.add('active');
            });
            console.log('Todo sheet opened');
          } else {
            console.error('Todo sheet not found');
          }
          
          // Close dropdown
          closeAllDropdowns();
        });
      }

      // Listen for auth state changes to update navigation
      supabase.auth.onAuthStateChange((_event, session) => {
        console.log('Auth state changed:', session ? 'logged in' : 'logged out');
        updateNavigationForAuthState();
        if (session) {
          hideAuthModal();
        } else {
          // Don't auto-show auth modal, let user trigger it manually
          console.log('User not logged in, but not auto-showing auth modal');
        }
      });
    });
  </script>
  <script src="main.js"></script>
</body>
</html>
